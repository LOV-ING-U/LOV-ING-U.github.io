---
title: "Project : RainMind 개발일지 - 9 [서버 성능 테스트를 위한 기초 k6 스크립트, EC2 인스턴스 생성]"
last_modified_at: 2026-02-10
# date: 2026-01-23 01:00:00 +0900
categories:
  - Rainmind
---  
  
Redis의 메모리 사용량, DB 응답시간 등을 분석하기 위하여 k6를 이용한 성능 테스트를 진행해보려고 한다.  
  
1) 일단 k6를 설치했다.
https://grafana.com/docs/k6/latest/set-up/install-k6/ 에 나와있는 방법대로, Linux 명령어를 차례로 입력한다.  
로컬은 windows이지만, 테스트 하는 환경을 분리시키기 위해 linux로 설치한다.  
  
2) 로직의 응답이 정확한지 다시한번 확인하기 위해, swagger UI를 켜서 회원가입/로그인/로그아웃을 해본다.  
securityConfig.kt랑 requestFilter에서 uri 허용할때 오타를 내서 시간을 많이 잡아먹었다. 다음부턴 조심해야겠다.  
  
Swagger 들어가면 이렇게 뜬다.  
![swagger](/pictures/swagger.JPG)  
   
응답이 200/201/200 이면 성공이다.  
  
3) mysql 콘솔로 직접 들어가서 보자.  
WSL에 **docker exec**(도커 실행) **-it**(명령어 인터렉티브 조작) **rainmind_mysql**(들어갈 컨테이너 이름) **mysql -urainmind**(mysql 유저이름이 rainmind) **-pxxxxxxxx**(비밀번호) **rainmind**(사용할 데이터베이스의 이름)  
  
redis 콘솔도 가능하다. 동일한 방식으로 **docker exec -it rainmind_redis redis-cli**를 실행하면 된다. redis-cli는, rainmind_redis 컨테이너 안에서 redis 전용 커맨드라인 도구를 실행하라는 뜻이다.  
  
docker-compose.yaml 파일에서 컨테이너 이름, url, username, pw 등을 설정할 수 있다.  
  
아까 swagger를 통해 생성했던 유저가 mysql db에 잘 들어간 것을 볼 수 있다.  
![checkdb](/pictures/2.JPG)  
  
이제 로그인 이후 schedule 생성하는 api를 호출해야 한다. 그냥 호출하면 JWT 인증 토큰을 못붙이므로, OpenApiConfig.kt 파일을 별도로 만들어, swagger 에서 토큰을 자동으로 붙이도록 해주었다.  
  
4) k6 스크립트 작성해서 테스트 진행  
우선 로그인 1명의 유저에 대해 반복 접근하는 기초적인 스크립트부터 작성 후 실행했다.  
![login_N_test.js](/pictures/3.JPG)  
  
오 된다.  
로그를 한번 해석해보자.  
  
* http_reqs: 9 = 요청을 9번 했음  
* http_req_failed: 0 = 요청 전부 성공  
* http_req_duration: avg = 121.36ms 평균 수치  
* p(90, 95): 전체 요청 중, 가장 느린 상위 (100-90), (100-95)%의 사용자가 체감한 요청 시간  
  
로그인 + 일정 생성도 같이 해본다.  
![login_and_schedule_Test.js](/pictures/4.JPG)  
  
잘 되는 것을 확인할 수 있다.  
  
5) 이제 할 것은 서버 실행환경과 스크립트 환경을 분리하는 것이다. + EC2 접속   
일반적으로, 서비스를 이용하는 것은 클라이언트(=로컬)고, 서버는 주로 외부(=AWS EC2)이므로 EC2 인스턴스를 생성해야 정확한 테스트가 될 것이다.  
  
이제 EC2 인스턴스를 생성하자.  
  
프리티어로 제공되는 것 중에 RAM이 제일 큰 걸로 선택하고, storage는 20으로 설정했다.  
RSA 암호화 키를 발급받고, chmod로 키 권한 user read only로 바꿔주고 ssh -i xxx.pem ubuntu@yyyy.y.y.y로 접속하면 된다.  
  
접속하고, 도커를 설치한다.  
```java
sudo apt update
sudo apt upgrade -y // 시스템 업그레이드 & 업데이트  
  
sudo apt install docker.io -y // 도커 설치

sudo systemctl start docker
sudo systemctl enable docker // 도커 실행 및 도커 자동실행 on
```  
  
여기에 추가로, 현재 사용자에게 도커 권한을 부여하려면  
```java
sudo usermod -aG docker $USER
```  
하고 재접속 하면 된다고 한다(편의용).  
  
이제 docker compose(여러 개의 컨테이너를 한번에 띄워주도록 해주는 것)도 추가로 설치한다.  
```java
sudo apt install docker-compose -y
```  
  
이후 내 코드를 가져오기 위해 git을 설치 및 git clone을 통해 프로젝트를 가져온다.  
```java
sudo apt install git -y // git 설치
git clone <.git 링크> // github의 프로젝트 가져오기
```  
  
이러면 EC2라는 가상 컴퓨터에 git, docker, docker compose, 그리고 내 프로젝트 코드까지 전부 설치가 완료된다.  
  
6) 환경변수 설정(env) 및 docker compose 설정하기(docker-compose.yaml)  
보안상 올릴 수 없었던 외부 인증키 등을 EC2에서 .env로 만들어 주입한다. 추가로 docker-compose.yaml도 설정한다.  
  
```java
nano .env // 이후 작업

```